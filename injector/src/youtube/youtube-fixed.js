console.log("allow pasting"),console.log("_legacyUndefinedCheck: true");let audioNode=null,lastDateText="Streaming dimulai baru saja",latestFetchedData=null,lastLoggedViewCount=null,countdownInterval=null,sponsorSegments=[],currentSponsorSegment=null,skipButton=null,skipSettings={sponsor:"manual",selfpromo:"manual",interaction:"manual",intro:"manual",outro:"manual",preview:"manual",music_offtopic:"manual",filler:"manual"};const filterConfig={ytInitialData:["videoPrimaryInfoRenderer","!videoPrimaryInfoRenderer.videoActions","!videoPrimaryInfoRenderer.updatedMetadataEndpoint","videoSecondaryInfoRenderer.owner","!videoSecondaryInfoRenderer.owner.videoOwnerRenderer.membershipButton","!trackingParams","!clickTrackingParams","!miniplayer","!contextParams","!dislikeButtonViewModel","!segmentedLikeDislikeButtonViewModel.dislikeButtonViewModel"],ytInitialPlayerResponse:["videoDetails","playabilityStatus","!playabilityStatus.miniplayer","!playabilityStatus.contextParams","playerConfig","microformat","!miniplayer","!contextParams","!trackingParams","!clickTrackingParams","!videoDetails.keywords","!playabilityStatus.reason","!playerMicroformatRenderer.availableCountries"]};function formatDateTime(e){try{const t=new Date(e);return isNaN(t.getTime())?null:t.toLocaleString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"})}catch(t){return console.warn(`Failed to format date: ${e}`,t),null}}function filterData(e,t){if(!e||"object"!=typeof e)return e;const n=t.filter(e=>!e.startsWith("!")).map(e=>e.split(".").flatMap(e=>e.match(/(\w+)\[(\d+)\]/)?[e.match(/(\w+)\[(\d+)\]/)[1],parseInt(e.match(/(\w+)\[(\d+)\]/)[2])]:[e])),o=t.filter(e=>e.startsWith("!")).map(e=>e.slice(1).split(".").flatMap(e=>e.match(/(\w+)\[(\d+)\]/)?[e.match(/(\w+)\[(\d+)\]/)[1],parseInt(e.match(/(\w+)\[(\d+)\]/)[2])]:[e])),i=o.filter(e=>1===e.length).map(e=>e[0]),a=(e,t,n)=>{let o=e;for(let e=0;e<t.length-1;e++){const n=t[e];o[n]=o[n]||(isNaN(t[e+1])?{}:[]),o=o[n]}o[t[t.length-1]]=n},r=(e,t,n={},o=[])=>{if(e&&"object"==typeof e)return Object.entries(e).forEach(([e,i])=>{const s=[...o,e];if(t.forEach(e=>{const t=e.join(".").replace(/\.(\d+)/g,"[$1]");if(s.join(".").replace(/\.(\d+)/g,"[$1]").endsWith(t)){const t=s.slice(-e.length);a(n,t,i)}}),(e.toLowerCase().includes("date")||e.toLowerCase().includes("time"))&&"string"==typeof i&&i.match(/^\d{4}-\d{2}-\d{2}T/)){const t=formatDateTime(i);t&&a(n,[...o,`formatted${e.charAt(0).toUpperCase()+e.slice(1)}`],t);const r=getRelativeDateText(i);r&&a(n,[...o,`relativeDateText${e.charAt(0).toUpperCase()+e.slice(1)}`],r)}(Array.isArray(i)||"object"==typeof i)&&r(i,t,n,s)}),n},s=(e,t,n)=>{e&&"object"==typeof e&&(n.forEach(t=>delete e[t]),t.filter(e=>e.length>1).forEach(t=>{let n=e;for(let e=0;e<t.length-1;e++){const o=t[e];if(!n[o])return;n=n[o]}delete n[t[t.length-1]]}),Object.values(e).forEach(e=>{(Array.isArray(e)||"object"==typeof e)&&s(e,t,n)}))};let l=r(e,n);return s(l,o,i),l}function extractJSON(e,t,n){const o=[new RegExp(`(?:var |const |let |\\s*)${t}\\s*=[=]?\\s*(\\{[\\s\\S]*?\\})(?=\\s*;|\\s*<\\/script>|\\s*$)`,"s"),new RegExp(`window\\s*\\[\\s*["']${t}["']\\s*\\]\\s*=[=]?\\s*(\\{[\\s\\S]*?\\})(?=\\s*;|\\s*<\\/script>|\\s*$)`,"s"),new RegExp(`(?:\\s*)${t}\\s*=[=]?\\s*(\\{[\\s\\S]*?\\})\\s*(?=;|<\\/script>|$)`,"s"),new RegExp(`<script[^>]*>\\s*${t}\\s*=[=]?\\s*(\\{[\\s\\S]*?\\})\\s*(?:;|<\\/script>)`,"s")];for(let i=0;i<o.length;i++){const a=e.match(o[i]);if(a&&a[1]){console.log(`extractJSON - ${t} found with pattern ${i+1}`);try{return filterData(JSON.parse(a[1]),n)}catch(e){console.warn(`extractJSON - Failed to parse ${t} with pattern ${i+1}:`,e);continue}}}const i=e.slice(0,500);throw console.error(`[${t}] not found. HTML snippet: ${i}`),new Error(`[${t}] not found`)}async function getCombinedData(e){try{const t=(new DOMParser).parseFromString(e,"text/html"),n=Array.from(t.querySelectorAll("script")).find(e=>e.textContent.includes("ytInitialData")),o=Array.from(t.querySelectorAll("script")).find(e=>e.textContent.includes("ytInitialPlayerResponse"));if(!n||!o)return console.warn("getCombinedData - Tidak dapat menemukan script yang mengandung ytInitialData atau ytInitialPlayerResponse"),null;const i=n.textContent.match(/ytInitialData\s*=\s*({[\s\S]*?});/),a=o.textContent.match(/ytInitialPlayerResponse\s*=\s*({[\s\S]*?});/);if(!(i&&i[1]&&a&&a[1]))return console.warn("getCombinedData - Tidak dapat menemukan JSON dalam script"),null;const r=JSON.parse(i[1]),s=JSON.parse(a[1]);return{videoId:getCurrentVideoId(),initialData:filterData(r,filterConfig.ytInitialData),playerResponse:filterData(s,filterConfig.ytInitialPlayerResponse)}}catch(e){return console.error("getCombinedData - Error:",e),null}}let shouldAddEventListenerTimeUpdate=!0;function getElement(e){return document.querySelector(e)}function getElements(e){return document.querySelectorAll(e)}function getVideoElement(){return getElement("video")}function getPlayerElement(){return getElement("#movie_player")}function getCurrentVideoId(){return new URL(location.href).searchParams.get("v")}function getSavedTime(e){return localStorage.getItem(`yt_time_${e}`)}function getSkipSettings(){try{const e=localStorage.getItem("skipSettings");return e?JSON.parse(e):{sponsor:"manual",selfpromo:"manual",interaction:"manual",intro:"manual",outro:"manual",preview:"manual",music_offtopic:"manual",filler:"manual"}}catch(e){return console.error("Error loading skip settings:",e),{sponsor:"manual",selfpromo:"manual",interaction:"manual",intro:"manual",outro:"manual",preview:"manual",music_offtopic:"manual",filler:"manual"}}}function getFetchInterval(){return localStorage.getItem("fetchInterval")||""}function getSpamInterval(){return localStorage.getItem("spamInterval")}function getOrCreateUserID(){const e="sponsorblock_userid";let t=localStorage.getItem(e);return t||(t=getGeneratedUserID(),localStorage.setItem(e,t)),t}function getGeneratedUserID(){const e="0123456789abcdef";let t="";for(let n=0;n<30;n++)t+=e[Math.floor(16*Math.random())];return t}function getVideoDuration(){const e=getVideoElement();return e?e.duration:null}function getCurrentVideoTime(){const e=getVideoElement();return e?e.currentTime:0}function getVideoTitle(){const e=getElement("#title > h1");return e?e.textContent:""}function getChannelTitle(){const e=getElement("#channel-name a");return e?e.textContent:""}function getIsPlaylist(){return new URLSearchParams(window.location.search).has("list")}function getIsLiveFromData(e){return e.videoPrimaryInfoRenderer.viewCount?.videoViewCountRenderer?.isLive}function getIsUpcomingFromData(e){return e?.videoDetails?.isUpcoming}function getViewCountFromData(e){const t=e?.items?.[0];return t?getIsLiveFromData(e)||getIsUpcomingFromData(e)?t.liveStreamingDetails?.concurrentViewers||"0":t.statistics?.viewCount||"0":"0"}function getDateTextFromData(e){const t=e?.items?.[0];return t&&t.snippet?.publishedAt||"Dipublikasikan baru saja"}function getChannelTitleFromData(e){const t=e?.items?.[0];return t&&t.snippet?.channelTitle||""}function getSegmentTypeLabel(e){return{sponsor:"Sponsor",selfpromo:"Promosi",interaction:"Interaksi",intro:"Intro",outro:"Outro",preview:"Preview",music_offtopic:"Musik/Offtopic",filler:"Filler"}[e]||"Segmen"}function getSegmentSkipSetting(e){return getSkipSettings()[e]||"manual"}function getIsAutoSkip(e){return"auto"===getSegmentSkipSetting(e)}function getIsManualSkip(e){return"manual"===getSegmentSkipSetting(e)}function getCurrentTimeFormatted(){return getFormattedTime(getCurrentVideoTime())}function getVideoDurationFormatted(){const e=getVideoDuration();return e?getFormattedTime(e):"00:00:00"}function getIsVideoPlaying(){const e=getVideoElement();return!!e&&!e.paused}function getIsVideoMuted(){const e=getVideoElement();return!!e&&e.muted}function getVideoVolume(){const e=getVideoElement();return e?e.volume:0}function getVideoPlaybackRate(){const e=getVideoElement();return e?e.playbackRate:1}function getIsVideoFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)}function getIsVideoTheaterMode(){return document.body.classList.contains("watch-wide")}function getIsVideoMiniplayerMode(){return document.body.classList.contains("watch-miniplayer")}function getIsVideoPictureInPicture(){return document.pictureInPictureElement===getVideoElement()}function getSecondsFromTime(e){const[t,n,o]=e.split(":").map(Number);return 3600*t+60*n+o}function getTimeStringFromSeconds(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%60);return[t.toString().padStart(2,"0"),n.toString().padStart(2,"0"),o.toString().padStart(2,"0")].join(":")}function getFormattedNumber(e,t=","){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)}function getFormattedPercentage(e,t,n=1){if(0===t)return"0%";return`${(e/t*100).toFixed(n)}%`}function getFormattedFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}function getFormattedDuration(e){return e<60?`${Math.floor(e)} detik`:e<3600?`${Math.floor(e/60)} menit`:e<86400?`${Math.floor(e/3600)} jam`:`${Math.floor(e/86400)} hari`}function getFormattedDate(e){return new Date(e).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",weekday:"long"})}function getFormattedTimeIndonesian(e){return new Date(e).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function getFormattedDateTime(e){return`${getFormattedDate(e)} ${getFormattedTimeIndonesian(e)}`}function getIsValidTimeFormat(e){return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/.test(e)}function getIsValidUrl(e){try{return new URL(e),!0}catch{return!1}}function getIsValidYouTubeUrl(e){if(!getIsValidUrl(e))return!1;const t=new URL(e);return t.hostname.includes("youtube.com")||t.hostname.includes("youtu.be")}function getIsValidVideoId(e){return/^[a-zA-Z0-9_-]{11}$/.test(e)}function getIsValidFetchCode(e){return/^fetch.*https:\/\//.test(e)}function getIsValidInterval(e){return/^\d+$/.test(e)&&parseInt(e,10)>0}function getIsValidSegmentData(e){return e&&"number"==typeof e.startTime&&"number"==typeof e.endTime&&e.startTime>=0&&e.endTime>e.startTime&&e.category}function getIsValidNotificationType(e){return["info","success","warning","error"].includes(e)}function getIsElementVisible(e){if(!e)return!1;const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity}function getIsElementInViewport(e){if(!e)return!1;const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function getIsElementClickable(e){if(!e)return!1;const t=window.getComputedStyle(e);return"none"!==t.pointerEvents&&"not-allowed"!==t.cursor&&!e.disabled}function getIsBrowserSupportsFeature(e){return{pictureInPicture:"pictureInPictureEnabled"in document,fullscreen:"fullscreenEnabled"in document,webAudio:"AudioContext"in window||"webkitAudioContext"in window,localStorage:"localStorage"in window,sessionStorage:"sessionStorage"in window,fetch:"fetch"in window,promises:"Promise"in window,asyncAwait:(()=>{try{return new Function("async () => {}"),!0}catch{return!1}})()}[e]||!1}try{const e=localStorage.getItem("skipSettings");e&&(skipSettings=JSON.parse(e))}catch(e){console.error("Error loading skip settings:",e)}const $=getElement,$$=getElements,wait=e=>new Promise(t=>setTimeout(t,e));function setupSkipSettingsListeners(){const e={skipSettingsPopup:$("#skip-settings-popup"),toggleSkipSettingsButton:$("#toggle-skip-settings"),saveSkipSettingsButton:$("#save-skip-settings"),closeSkipSettingsButton:$("#close-skip-settings"),skipSettingSelects:$$(".skip-setting-item select")};e.toggleSkipSettingsButton?.addEventListener("click",()=>{e.skipSettingsPopup.style.display="block"}),e.closeSkipSettingsButton?.addEventListener("click",()=>{e.skipSettingsPopup.style.display="none"}),e.skipSettingsPopup?.addEventListener("click",t=>{t.target===e.skipSettingsPopup&&(e.skipSettingsPopup.style.display="none")}),e.saveSkipSettingsButton?.addEventListener("click",()=>{const t=getSkipSettings();e.skipSettingSelects.forEach(e=>{const n=e.getAttribute("data-type");t[n]=e.value}),localStorage.setItem("skipSettings",JSON.stringify(t)),e.skipSettingsPopup.style.display="none",console.log("Skip settings saved:",t)}),document.addEventListener("keydown",t=>{"Escape"===t.key&&"block"===e.skipSettingsPopup.style.display&&(e.skipSettingsPopup.style.display="none")})}function waitForUrlChange(){return new Promise(e=>{let t=location.href;const n=()=>{location.href!==t?(t=location.href,e(t)):requestAnimationFrame(n)};n()})}function waitForElement(e){return new Promise(t=>{const n=()=>{const o=getElement(e);o?t(o):requestAnimationFrame(n)};n()})}async function main(){if(!document.body)return requestAnimationFrame(main);await waitForElement("#logo-icon > span").then(function(){const e=$$("#logo-icon > span");if(e.length)for(const t of e)if(!t.shadowRoot){t.attachShadow({mode:"open"}).innerHTML='\n          <div injected style="width: 100%; height: 100%; display: block; fill: currentcolor;">\n            <?xml version="1.0" encoding="UTF-8"?>\n            <svg class="external-icon" display="inherit" pointer-events="none" style="height:100%;width:100%" focusable="false" viewBox="0 0 90 20" xmlns="http://www.w3.org/2000/svg">\n              <svg viewBox="0 0 97 20" xmlns="http://www.w3.org/2000/svg">\n                <path d="m27.97 3.1232c-0.3293-1.23-1.2959-2.1966-2.5259-2.5259-2.2272-0.59737-11.162-0.59737-11.162-0.59737s-8.9346 2.2429e-7 -11.162 0.59737c-1.2276 0.32926-2.1966 1.2959-2.5259 2.5259-0.59501 2.2272-0.59501 6.8768-0.59501 6.8768s-1.57e-6 4.6496 0.59736 6.8768c0.32926 1.23 1.2959 2.1966 2.5259 2.5258 2.2272 0.5974 11.162 0.5974 11.162 0.5974s8.9347 0 11.162-0.5974c1.2301-0.3292 2.1967-1.2958 2.5259-2.5258 0.5974-2.2272 0.5974-6.8768 0.5974-6.8768s-0.0024-4.6496-0.5997-6.8768z" fill="#f00"/>\n                <path d="m11.428 14.285 7.42-4.285-7.42-4.2851v8.5701z" fill="#fff"/>\n                <path d="m40.057 6.3452v0.69144c0 3.4548-1.5311 5.4751-4.8824 5.4751h-0.5104v6.0465h-2.7375v-17.135h3.4877c3.1938 0 4.6426 1.35 4.6426 4.9224zm-2.8787 0.24694c0-2.4929-0.4492-3.0856-2.0014-3.0856h-0.5103v6.9661h0.4703c1.4699 0 2.0438-1.063 2.0438-3.3702l-0.0024-0.51035z"/>\n                <path d="m46.534 5.8345-0.1435 3.2479c-1.1642-0.24459-2.1261-0.06115-2.5541 0.69144v8.7841h-2.7164v-12.519h2.1661l0.2446 2.714h0.1034c0.2846-1.9802 1.2042-2.9821 2.3895-2.9821 0.1717 0.0047 0.3434 0.02587 0.5104 0.0635z"/>\n                <path d="m49.657 13.246v0.6326c0 2.206 0.1223 2.9633 1.0631 2.9633 0.8984 0 1.103-0.6914 1.1241-2.1237l2.4295 0.1435c0.1834 2.6952-1.2253 3.9017-3.6148 3.9017-2.8998 0-3.7582-1.9003-3.7582-5.3504v-2.1896c0-3.6359 0.9595-5.4139 3.8405-5.4139 2.8998 0 3.636 1.5122 3.636 5.2893v2.1472h-4.7202zm0-2.5753v0.8984h2.0626v-0.8937c0-2.3024-0.1646-2.9633-1.0372-2.9633-0.8725 0-1.0254 0.67497-1.0254 2.9633v-0.0047z"/>\n                <path d="m68.41 9.099v9.4567h-2.8175v-9.2474c0-1.0207-0.2658-1.531-0.8796-1.531-0.4916 0-0.9408 0.28457-1.2465 0.81609 0.0165 0.16933 0.0235 0.34101 0.0212 0.51035v9.4568h-2.8199v-9.2522c0-1.0207-0.2658-1.531-0.8796-1.531-0.4915 0-0.9219 0.28457-1.2253 0.79727v9.9882h-2.8175v-12.524h2.2272l0.2493 1.5945h0.04c0.6326-1.2041 1.6557-1.858 2.8598-1.858 1.1853 0 1.858 0.59266 2.1661 1.6557 0.6538-1.0818 1.6345-1.6557 2.7563-1.6557 1.7121 0 2.366 1.2253 2.366 3.3231z"/>\n                <path d="m69.819 2.8338c0-1.3476 0.4915-1.7357 1.531-1.7357 1.0631 0 1.5311 0.4492 1.5311 1.7357 0 1.3899-0.4704 1.738-1.5311 1.738-1.0395-0.00236-1.531-0.35043-1.531-1.738zm0.1646 3.2056h2.6952v12.524h-2.6952v-12.524z"/>\n                <path d="m81.891 6.0396v12.524h-2.2061l-0.2446-1.5311h-0.0611c-0.6326 1.2253-1.5522 1.7357-2.6952 1.7357-1.6745 0-2.4318-1.0631-2.4318-3.3702v-9.3556h2.8175v9.1933c0 1.103 0.2305 1.5522 0.7973 1.5522 0.5174-0.0211 0.9807-0.3292 1.2018-0.7972v-9.9483h2.8222v-0.00235z"/>\n                <path d="m96.19 9.0989v9.4568h-2.8175v-9.2474c0-1.0207-0.2658-1.531-0.8796-1.531-0.4915 0-0.9407 0.28457-1.2465 0.81609 0.0165 0.16698 0.0236 0.33631 0.0212 0.50564v9.4568h-2.8175v-9.2474c0-1.0207-0.2657-1.531-0.8796-1.531-0.4915 0-0.9219 0.28457-1.2253 0.79727v9.9882h-2.8175v-12.524h2.2249l0.2446 1.5922h0.0399c0.6327-1.2041 1.6557-1.858 2.8599-1.858 1.1853 0 1.8579 0.59266 2.166 1.6557 0.6538-1.0818 1.6345-1.6557 2.7563-1.6557 1.7216 0.00235 2.3707 1.2277 2.3707 3.3255z"/>\n                <path d="m40.057 6.3452v0.69144c0 3.4548-1.5311 5.4751-4.8824 5.4751h-0.5104v6.0465h-2.7375v-17.135h3.4877c3.1938 0 4.6426 1.35 4.6426 4.9224zm-2.8787 0.24694c0-2.4929-0.4492-3.0856-2.0014-3.0856h-0.5103v6.9661h0.4703c1.4699 0 2.0438-1.063 2.0438-3.3702l-0.0024-0.51035z"/>\n              </svg>\n            </svg>\n          </div>\n        '}const t={"a.ytd-topbar-logo-renderer":e=>e.removeAttribute("href"),"ytd-topbar-logo-renderer#logo":e=>e.removeAttribute("show-yoodle"),"a#logo.ytd-topbar-logo-renderer>div.ytd-topbar-logo-renderer":e=>e.removeAttribute("hidden"),"#country-code.ytd-topbar-logo-renderer":e=>e.removeAttribute("hidden"),"#logo.ytd-topbar-logo-renderer":e=>e.setAttribute("title","Beranda YouTube Premium")};for(const[e,n]of Object.entries(t))$$(e).forEach(n)}),await waitForElement("#logo-icon > span > div").then(function(){const e=$("#end");if(!e||$("#toggle-fetch-input")||$("#fetch-popup"))return;const t=document.createElement("button");t.id="toggle-fetch-input",t.className="style-scope toggle-fetch",t.setAttribute("alt","Toggle Fetch Input"),t.setAttribute("title","Spam Web Request"),t.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="1.6em" height="1.6em" viewBox="0 0 14 14">\n        <path fill="none" stroke="white" stroke-linecap="round" stroke-linejoin="round" d="m.5 10.5l10-10H6m7.5 3l-10 10H8" />\n      </svg>\n    ';const n=document.createElement("button");n.id="toggle-skip-settings",n.className="style-scope toggle-skip-settings",n.setAttribute("alt","Toggle Skip Settings"),n.setAttribute("title","Atur Skip Sponsor"),n.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="1.6em" height="1.6em" viewBox="0 0 24 24">\n        <path fill="white" d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.12-.22-.07-.49.12-.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5s3.5 1.57 3.5 3.5s-1.57 3.5-3.5 3.5z"/>\n      </svg>\n    ',e.insertAdjacentElement("afterbegin",n),e.insertAdjacentElement("afterbegin",t);const o=document.createElement("div");o.id="skip-settings-popup",o.className="skip-settings-popup",o.style.display="none";const i=getSkipSettings();o.innerHTML=`\n      <div class="skip-settings-popup-content">\n        <h3>Pengaturan Skip Sponsor</h3>\n        <div class="skip-settings-list">\n          <div class="skip-setting-item">\n            <label>Sponsor</label>\n            <select data-type="sponsor">\n              <option value="manual" ${"manual"===i.sponsor?"selected":""}>Manual</option>\n              <option value="auto" ${"auto"===i.sponsor?"selected":""}>Otomatis</option>\n            </select>\n          </div>\n          <div class="skip-setting-item">\n            <label>Self Promo</label>\n            <select data-type="selfpromo">\n              <option value="manual" ${"manual"===i.selfpromo?"selected":""}>Manual</option>\n              <option value="auto" ${"auto"===i.selfpromo?"selected":""}>Otomatis</option>\n            </select>\n          </div>\n          <div class="skip-setting-item">\n            <label>Interaksi</label>\n            <select data-type="interaction">\n              <option value="manual" ${"manual"===i.interaction?"selected":""}>Manual</option>\n              <option value="auto" ${"auto"===i.interaction?"selected":""}>Otomatis</option>\n            </select>\n          </div>\n          <div class="skip-setting-item">\n            <label>Intro</label>\n            <select data-type="intro">\n              <option value="manual" ${"manual"===i.intro?"selected":""}>Manual</option>\n              <option value="auto" ${"auto"===i.intro?"selected":""}>Otomatis</option>\n            </select>\n          </div>\n          <div class="skip-setting-item">\n            <label>Outro</label>\n            <select data-type="outro">\n              <option value="manual" ${"manual"===i.outro?"selected":""}>Manual</option>\n              <option value="auto" ${"auto"===i.outro?"selected":""}>Otomatis</option>\n            </select>\n          </div>\n          <div class="skip-setting-item">\n            <label>Preview</label>\n            <select data-type="preview">\n              <option value="manual" ${"manual"===i.preview?"selected":""}>Manual</option>\n              <option value="auto" ${"auto"===i.preview?"selected":""}>Otomatis</option>\n            </select>\n          </div>\n          <div class="skip-setting-item">\n            <label>Musik/Offtopic</label>\n            <select data-type="music_offtopic">\n              <option value="manual" ${"manual"===i.music_offtopic?"selected":""}>Manual</option>\n              <option value="auto" ${"auto"===i.music_offtopic?"selected":""}>Otomatis</option>\n            </select>\n          </div>\n          <div class="skip-setting-item">\n            <label>Filler</label>\n            <select data-type="filler">\n              <option value="manual" ${"manual"===i.filler?"selected":""}>Manual</option>\n              <option value="auto" ${"auto"===i.filler?"selected":""}>Otomatis</option>\n            </select>\n          </div>\n        </div>\n        <div class="skip-settings-buttons">\n          <button id="close-skip-settings">Tutup</button>\n          <button id="save-skip-settings">Simpan</button>\n        </div>\n      </div>\n    `,document.body.appendChild(o),setupSkipSettingsListeners();const a=document.createElement("div");a.id="fetch-popup",a.className="fetch-popup",a.style.display="none",a.innerHTML=`\n      <div class="fetch-popup-content">\n        <h3>Custom Fetch Configuration</h3>\n        <div class="fetch-input-group">\n          <label for="fetch-input">Fetch URL<span id="url-validation-message">*Invalid Fetch</span></label>\n          <input type="text" id="fetch-input" placeholder="Enter fetch URL..." autocomplete="off">\n        </div>\n        <div class="fetch-input-group">\n          <label for="fetch-interval">Interval (ms)<span id="interval-validation-message">*Invalid number</span></label>\n          <input type="number" id="fetch-interval" placeholder="Enter interval..." value="${getFetchInterval()}">\n        </div>\n        <div class="fetch-buttons">\n          <button id="close-popup">Close</button>\n          <button id="submit-fetch">Start Fetch</button>\n          <button id="stop-fetch" style="display: none;">Stop Fetch</button>\n        </div>\n      </div>\n    `,document.body.appendChild(a),document.addEventListener("keydown",e=>{"Escape"===e.key&&"block"===a.style.display?a.style.display="none":"Enter"===e.key&&"block"===a.style.display&&$("#submit-fetch")?.click()}),function(){const e={fetchPopup:$("#fetch-popup"),fetchInput:$("#fetch-input"),fetchIntervalInput:$("#fetch-interval"),submitFetchButton:$("#submit-fetch"),stopFetchButton:$("#stop-fetch"),closePopupButton:$("#close-popup"),toggleFetchButton:$("#toggle-fetch-input"),urlMessage:$("#url-validation-message"),intervalMessage:$("#interval-validation-message")};let t=null;const n=(t,n)=>{const o=getIsValidFetchCode(t),i=getIsValidInterval(n);return e.urlMessage.style.display=o?"none":"block",e.intervalMessage.style.display=i?"none":"block",o&&i},o=t=>{e.stopFetchButton.style.display=t?"inline-block":"none",e.submitFetchButton.style.display=t?"none":"inline-block"},i=(e,n)=>{t&&clearInterval(t),t=setInterval(()=>{try{new Function(e)()}catch(e){console.error("Error executing fetch code:",e)}},parseInt(n)),o(!0)},a=()=>{t&&(clearInterval(t),t=null,console.info("Fetch interval stopped"),o(!1))};e.toggleFetchButton?.addEventListener("click",()=>{e.fetchPopup.style.display="block"}),e.closePopupButton?.addEventListener("click",()=>{e.fetchPopup.style.display="none"}),e.fetchPopup?.addEventListener("click",t=>{t.target===e.fetchPopup&&(e.fetchPopup.style.display="none")}),e.submitFetchButton?.addEventListener("click",()=>{const t=e.fetchInput.value.trim(),o=e.fetchIntervalInput.value;n(t,o)&&(localStorage.setItem("spamInterval",o),i(t,o))}),e.stopFetchButton?.addEventListener("click",a);const r=getSpamInterval();r&&e.fetchIntervalInput&&(e.fetchIntervalInput.value=r)}()}),await waitForElement("#end").then(function(){return new Promise(e=>{const t=$("#end");if(!t)return e();const n=$("div.header-clock");n?.remove();const o=new Date,i=document.createElement("div");i.className="header-clock";const a=document.createElement("div");a.className="clock-digits",a.innerHTML=o.getHours().toString().padStart(2,"0");const r=document.createElement("div");r.className="clock-digits",r.innerHTML=o.getMinutes().toString().padStart(2,"0");const s=document.createElement("span");s.textContent=":",i.appendChild(a),i.appendChild(s),i.appendChild(r),t.insertAdjacentElement("afterbegin",i);const l=()=>{const e=new Date;a.innerHTML=e.getHours().toString().padStart(2,"0"),r.innerHTML=e.getMinutes().toString().padStart(2,"0"),setTimeout(l,1e3)};l(),e()})})}async function watch(){const e=getCurrentVideoId();await handleWatchPage(e)}async function handleWatchPage(e){console.log("📺 handleWatchPage - Dipanggil dari:",(new Error).stack.split("\n")[2]?.trim()||"unknown"),cleanupVideoElements(),lastLoggedViewCount=null,fetchData(e),await waitForElement("video"),handleVideoElement(),initializeSponsorSkip(),console.log(`Fetching new data for [${e}]`),interceptFetch()}async function handleVideoElement(){const e=getIsPlaylist(),t=await waitForElement("#movie_player"),n=await waitForElement("video");let o=!1;resolutionChange(),n.addEventListener("play",()=>{o||(console.log("video is playing"),o=!0,setHighestResolution(),e||(t.setLoop(!0),t.setLoopVideo(!0)),t.toggleSubtitles(),audioNode=createAudioNode(n))}),n.addEventListener("loadedmetadata",()=>{highlightSponsorSegments()}),n.addEventListener("seeking",()=>{highlightSponsorSegments()})}function createAudioNode(e){if(audioNode)return;if("true"===e.getAttribute("data-audio-processed"))return void console.log("Video sudah memiliki audio node");const t=new AudioContext,n=t.createMediaElementSource(e),o={inGain:t.createGain(),biquadFilter:t.createBiquadFilter(),outGain:t.createGain()};return[{frequency:31,gain:15},{frequency:62,gain:10},{frequency:125,gain:5},{frequency:250,gain:0},{frequency:500,gain:-5},{frequency:1e3,gain:-5},{frequency:2e3,gain:0},{frequency:4e3,gain:5},{frequency:8e3,gain:10},{frequency:16e3,gain:1}].forEach(({frequency:e,gain:t})=>{o.biquadFilter.frequency.value=e,o.biquadFilter.Q.value=4,o.biquadFilter.gain.value=t}),o.inGain.gain.value=.2,o.outGain.gain.value=6.5,n.connect(o.inGain).connect(o.biquadFilter).connect(o.outGain).connect(t.destination),console.log("Bass Boosted!"),audioNode=o,e.setAttribute("data-audio-processed","true"),e.setAttribute("data-audio-gain",o.outGain.gain.value),e.setAttribute("data-audio-filter","biquad"),!0}window.trustedTypes&&window.trustedTypes.createPolicy&&window.trustedTypes.createPolicy("default",{createHTML:e=>e,createScriptURL:e=>e,createScript:e=>e});class ObserverManager{constructor(){this.observers=new Map,this.eventListeners=new Map,this.intersectionObservers=new Map,this.resizeObservers=new Map,this.mutationObservers=new Map}registerMutationObserver(e,t,n,o){this.mutationObservers.has(e)&&(console.warn(`MutationObserver dengan ID ${e} sudah ada. Menghentikan observer lama.`),this.disconnectMutationObserver(e));try{const i=new MutationObserver(o);return i.observe(t,n),this.mutationObservers.set(e,{observer:i,target:t}),i}catch(t){return console.error(`Gagal membuat MutationObserver ${e}:`,t),null}}registerIntersectionObserver(e,t,n,o){this.intersectionObservers.has(e)&&(console.warn(`IntersectionObserver dengan ID ${e} sudah ada. Menghentikan observer lama.`),this.disconnectIntersectionObserver(e));try{const i=new IntersectionObserver(o,n);return t.forEach(e=>i.observe(e)),this.intersectionObservers.set(e,{observer:i,elements:t}),i}catch(t){return console.error(`Gagal membuat IntersectionObserver ${e}:`,t),null}}registerResizeObserver(e,t,n){this.resizeObservers.has(e)&&(console.warn(`ResizeObserver dengan ID ${e} sudah ada. Menghentikan observer lama.`),this.disconnectResizeObserver(e));try{const o=new ResizeObserver(n);return t.forEach(e=>o.observe(e)),this.resizeObservers.set(e,{observer:o,elements:t}),o}catch(t){return console.error(`Gagal membuat ResizeObserver ${e}:`,t),null}}registerEventListener(e,t,n,o,i={}){this.eventListeners.has(e)&&(console.warn(`Event listener dengan ID ${e} sudah ada. Menghapus listener lama.`),this.removeEventListener(e));try{let a=o;return i.debounce?a=this.debounce(o,i.debounce):i.throttle&&(a=this.throttle(o,i.throttle)),t.addEventListener(n,a,i),this.eventListeners.set(e,{element:t,eventType:n,callback:a,options:i}),a}catch(t){return console.error(`Gagal menambahkan event listener ${e}:`,t),null}}debounce(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...o)},t)}}throttle(e,t){let n;return function(...o){n||(e(...o),n=!0,setTimeout(()=>n=!1,t))}}disconnectMutationObserver(e){try{const t=this.mutationObservers.get(e);return!!t&&(t.observer.disconnect(),this.mutationObservers.delete(e),!0)}catch(t){return console.error(`Gagal menghentikan MutationObserver ${e}:`,t),!1}}disconnectIntersectionObserver(e){try{const t=this.intersectionObservers.get(e);return!!t&&(t.observer.disconnect(),this.intersectionObservers.delete(e),!0)}catch(t){return console.error(`Gagal menghentikan IntersectionObserver ${e}:`,t),!1}}disconnectResizeObserver(e){try{const t=this.resizeObservers.get(e);return!!t&&(t.observer.disconnect(),this.resizeObservers.delete(e),!0)}catch(t){return console.error(`Gagal menghentikan ResizeObserver ${e}:`,t),!1}}removeEventListener(e){try{const t=this.eventListeners.get(e);if(t){const{element:n,eventType:o,callback:i,options:a}=t;return n.removeEventListener(o,i,a),this.eventListeners.delete(e),!0}return!1}catch(t){return console.error(`Gagal menghapus event listener ${e}:`,t),!1}}disconnectAll(){try{return this.mutationObservers.forEach((e,t)=>this.disconnectMutationObserver(t)),this.intersectionObservers.forEach((e,t)=>this.disconnectIntersectionObserver(t)),this.resizeObservers.forEach((e,t)=>this.disconnectResizeObserver(t)),this.eventListeners.forEach((e,t)=>this.removeEventListener(t)),!0}catch(e){return console.error("Gagal menghentikan semua observer dan listener:",e),!1}}getStatus(e){const t={type:null,active:!1,details:null};return this.mutationObservers.has(e)?(t.type="MutationObserver",t.active=!0,t.details=this.mutationObservers.get(e)):this.intersectionObservers.has(e)?(t.type="IntersectionObserver",t.active=!0,t.details=this.intersectionObservers.get(e)):this.resizeObservers.has(e)?(t.type="ResizeObserver",t.active=!0,t.details=this.resizeObservers.get(e)):this.eventListeners.has(e)&&(t.type="EventListener",t.active=!0,t.details=this.eventListeners.get(e)),t}}const observerManager=new ObserverManager;async function fetchSponsorSegments(e){try{cleanupVideoElements();const t=await fetch(`https://sponsor.ajay.app/api/skipSegments?videoID=${e}`),n=await t.text();if(!n||""===n.trim()||"[]"===n.trim())return console.log("No segment found"),void(sponsorSegments=[]);const o=JSON.parse(n);if(console.log(`Segmen sponsor: ${o}`),!o||!Array.isArray(o)||0===o.length)return console.log("No segment found"),void(sponsorSegments=[]);if(sponsorSegments=o.filter(e=>["sponsor","selfpromo","interaction","intro","outro","preview","music_offtopic","filler"].includes(e.category)).map(e=>({start:e.segment[0],end:e.segment[1],type:e.category,videoDuration:e.videoDuration})),0===sponsorSegments.length)return void console.log("No segment found");if(sponsorSegments.length>0){const e=sponsorSegments[0].videoDuration,t=e-sponsorSegments.reduce((e,t)=>e+(t.end-t.start),0),n=e=>{const t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%60);return t>0?`${t}:${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`:`${n}:${o.toString().padStart(2,"0")}`},o=document.querySelector(".ytp-time-duration");if(o){const e=o.parentElement,i=e.querySelector(".ytp-time-watchable-container");i&&i.remove();const a=document.createElement("span");a.className="ytp-time-watchable-container",a.innerHTML=`<span class="ytp-time-watchable">(${n(t)})</span>`,e.appendChild(a)}}console.log("Segmen sponsor terdeteksi:",sponsorSegments),highlightSponsorSegments()}catch(e){e.message&&(e.message.includes("JSON.parse: unexpected character")||e.message.includes("Unexpected token")||e.message.includes("SyntaxError"))?console.log("No segment found"):console.error("Gagal mengambil data segmen sponsor:",e),sponsorSegments=[]}}async function initializeSegments(){const e=getCurrentVideoId();e&&await fetchSponsorSegments(e)}function initializeSponsorSkip(){const e=document.querySelector("video");e&&(observerManager.registerMutationObserver("urlChangeObserver",document.querySelector("head")||document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["content"]},async()=>{const e=location.href;window.lastUrl!==e&&(window.lastUrl=e,await initializeSegments())}),observerManager.registerEventListener("videoTimeUpdate",e,"timeupdate",()=>{const t=e.currentTime,n=sponsorSegments.find(e=>t>=e.start&&t<e.end);n&&n!==currentSponsorSegment?(currentSponsorSegment=n,getIsAutoSkip(n.type)?(e.currentTime=n.end,currentSponsorSegment=null):showSkipButton(e,n)):!n&&currentSponsorSegment&&(currentSponsorSegment=null,hideSkipButton())},{throttle:100}),observerManager.registerEventListener("keyboardSkip",document,"keydown",t=>{"Enter"===t.key&&currentSponsorSegment&&skipCurrentSegment(e)}),initializeSegments())}function showSkipButton(e,t){skipButton?skipButton.innerHTML=`(Enter) Skip ${getSegmentTypeLabel(t.type)}`:(skipButton=document.createElement("button"),skipButton.className="sponsor-skip-button",skipButton.innerHTML=`(Enter) Skip ${getSegmentTypeLabel(t.type)}`,skipButton.onclick=()=>skipCurrentSegment(e),document.querySelector(".html5-video-player").appendChild(skipButton)),skipButton.style.display="flex"}function hideSkipButton(){skipButton&&(skipButton.style.display="none")}function skipCurrentSegment(e){currentSponsorSegment&&(e.currentTime=currentSponsorSegment.end,currentSponsorSegment=null,hideSkipButton())}async function highlightSponsorSegments(){const e=document.querySelector(".ytp-progress-list");if(!e||!document.querySelector("video"))return;const t=getCurrentVideoId();document.querySelectorAll(".sponsor-segment-highlight").forEach(e=>e.remove());const n=document.querySelector("video"),o=n.duration;if(!o)return;const i=document.querySelectorAll(".ytp-chapter-hover-container");sponsorSegments.forEach(t=>{let a=e,r=t.start/o*100,s=(t.end-t.start)/o*100;if(i.length>0){let e=0,l=!1;for(let c of i){const i=parseFloat(c.style.width)/n.offsetWidth*100,u=(e+i)*o/100,d=e*o/100;if(t.start>=d&&t.start<u){a=c.querySelector(".ytp-progress-list"),r=(t.start-d)/(u-d)*100,s=Math.min((t.end-t.start)/(u-d)*100,100-r),l=!0;break}e+=i}if(l&&s>=100){const a=t.end-e*o/100;if(a>0){const r=i[Math.floor(e/(100/i.length))+1];if(r){createHighlight(r.querySelector(".ytp-progress-list"),0,a/(parseFloat(r.style.width)/n.offsetWidth*100*o/100)*100,t.type)}}}}createHighlight(a,r,s,t.type)}),addSubmitButton(t)}function createHighlight(e,t,n,o){const i=document.createElement("div");i.className="sponsor-segment-highlight",i.setAttribute("data-segment-type",o),i.style.left=`${t}%`,i.style.width=`${n}%`,e.appendChild(i)}function addSubmitButton(e){const t=document.querySelector(".ytp-right-controls");if(t&&!document.querySelector(".submit-segment-button")){const n=document.createElement("button");n.className="ytp-button submit-segment-button",n.title="Submit Sponsor Segment",n.innerHTML='\n      <svg height="75%" version="1.1" viewBox="0 0 36 36" width="75%" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">\n        <use class="ytp-svg-shadow" xlink:href="#ytp-id-submit-segment"></use>\n        <path d="M18,8 L18,28 M8,18 L28,18" stroke="#fff" stroke-width="2.5" fill="none" id="ytp-id-submit-segment"></path>\n      </svg>\n    ',n.setAttribute("data-priority","4"),n.addEventListener("click",t=>{t.stopPropagation();const n=document.querySelector("video");n&&showSubmitSegmentForm(e,n.currentTime)});const o=t.querySelector(".ytp-subtitles-button");o?t.insertBefore(n,o):t.appendChild(n)}}async function fetchData(e,t){console.log(`🔄 fetchData dipanggil untuk videoId: ${e}`),console.log("🔄 fetchData - Dipanggil dari:",(new Error).stack.split("\n")[2]?.trim()||"unknown");try{const n=await fetch(window.location.href),o=await n.text(),i=await getCombinedData(o);if(console.log("🔄 fetchData - Combined data:",i),!i)throw console.warn("⚠️ Combined data tidak ditemukan dalam response"),new Error("Combined data not found");{const{initialData:n,playerResponse:o}=i;latestFetchedData=i;const{upcomingDateText:a,scheduledStartTime:r}=getUpcomingDateText(o)||{},s=n?.videoPrimaryInfoRenderer,l=n?.videoSecondaryInfoRenderer;if(!s||!l)throw console.warn("⚠️ Video info tidak dapat diambil dari initialData"),new Error("Video info not found");const c=s.viewCount?.videoViewCountRenderer,u=getIsLiveFromData(n),d="0"!==c?.originalViewCount?c?.originalViewCount.replace(".",""):o?.videoDetails?.viewCount||"0",m=getIsUpcomingFromData(o),p=l?.owner?.videoOwnerRenderer?.title?.runs?.[0]?.text||"",g=m&&a?a:m?s.dateText?.simpleText||"Tayang dalam waktu dekat":u?s.dateText?.simpleText||"Streaming dimulai baru saja":s.relativeDateText?.simpleText||s.dateText?.simpleText||"Dipublikasikan baru saja",h={videoId:e,title:s.title.runs[0].text,viewCount:d,channelTitle:p,dateText:g,isLive:u,isUpcoming:m,scheduledStartTime:r};console.log(`Video info fetched for [${e}]:`,h),m&&r&&startCountdown(r),await applyResumePlayback(n),displayData(h,t)}}catch(t){console.error(`There has been an error when fetching [${e}]:`,t)}}async function displayData(e,t){if(e&&e.videoId){const{videoId:n,viewCount:o,dateText:i,channelTitle:a,isLive:r,isUpcoming:s}=e;console.log(`data from displayData for [${e.videoId}]:`,e),latestFetchedData=e;const l=getRelativeDateText(i);lastLoggedViewCount!==o&&(console.log(`Views for [${n}]: ${o}, ${l}`),lastLoggedViewCount=o);const c={viewCount:o,date:l,channelTitle:a,isLive:r,isUpcoming:s,videoId:n};void 0===t?await addVideoIdAndViews(c):"refresh"===t&&(updateViewDisplay(o,r,s,l),console.log(`Refreshed views for [${n}]`))}else console.error(`Invalid data structure in displayData for [${e.videoId}]`)}async function addVideoIdAndViews(e){const{viewCount:t,date:n,channelTitle:o,isLive:i,isUpcoming:a,videoId:r}=e;try{await new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",e)});const e=await Promise.race([waitForElement("#above-the-fold > #top-row").then(e=>({element:e,type:"topRow"})),waitForElement("#title > h1").then(e=>({element:e,type:"title"}))]);$(".view-count-info")&&$(".view-count-info").remove(),$(".channelBy2")&&$(".channelBy2").remove(),$(".ytp-view-big-mode")&&$(".ytp-view-big-mode").remove();const s=getFormattedViewCount(t,i,a),l=document.createElement("div");l.className="style-scope view-count-info",l.innerHTML=`\n    <h1 class="style-scope ytd-view-renderer">\n        <div id="viewcount-renderer" class="viewcount-renderer">\n            <span class="odometer" data-value="${t}" data-is-live="${i}"></span>\n            <span class="odometer-suffix">${s.substring(s.indexOf(" "))}</span>\n            <strong class="separator"> • </strong>\n            <span id="date_text" class="style-scope ytd-watch-metadata">${n}</span>\n        </div>\n    </h1>\n    <button id="refresh-view-count" class="style-scope refresh-vc" alt="Refresh viewCount" title="Refresh Viewcount">\n        <svg xmlns="http://www.w3.org/2000/svg" width="1.7em" height="1.7em" viewBox="0 0 24 24">\n            <path fill="white"\n                d="M17.65 6.35A7.96 7.96 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z">\n            </path>\n        </svg>\n    </button>`,"topRow"===e.type?e.element.insertAdjacentElement("beforebegin",l):e.element.insertAdjacentElement("afterend",l),new Odometer({el:l.querySelector(".odometer"),value:parseInt(l.querySelector(".odometer").getAttribute("data-value")),theme:"minimal",locale:"id"}),$("#refresh-view-count").addEventListener("click",()=>{fetchData(r,"refresh")});const c=await waitForElement("div.ytp-title>div");if(c){const e=document.createElement("strong");e.className="channelBy2",e.textContent=`- ${o}`,c.appendChild(e);const n=await waitForElement("#movie_player > div.ytp-chrome-top > div.ytp-chrome-top-buttons");if(n){const e=document.createElement("div");e.className="ytp-view-big-mode",e.setAttribute("aria-haspopup","true"),e.setAttribute("data-tooltip-opaque","true"),e.innerHTML=`\n          <div class="odometer" data-value="${t}" data-is-live="${i}"></div>\n          <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><path fill="white" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4s-4 1.79-4 4s1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v1c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-1c0-2.66-5.33-4-8-4"/></svg>\n        `,n.insertAdjacentElement("beforebegin",e),new Odometer({el:e.querySelector(".odometer"),value:parseInt(e.querySelector(".odometer").getAttribute("data-value")),theme:"minimal",locale:"id"})}}console.log(`Video ID and views for [${r}] added!`)}catch(e){console.error(`Error in addVideoIdAndViews for [${r}]:`,e)}}function updateViewDisplay(e,t,n,o){const i=$("#viewcount-renderer .odometer"),a=$("#viewcount-renderer .odometer-suffix"),r=$("#date_text"),s=$("#movie_player > div.ytp-chrome-top > div.ytp-view-big-mode .odometer");if(i){if(i.odometer.update(e),i.setAttribute("data-value",e),a){const o=getFormattedViewCount(e,t,n);a.textContent=o.substring(o.indexOf(" "))}r&&(r.textContent=o)}s&&(s.odometer.update(e),s.setAttribute("data-value",e))}async function resolutionChange(){await waitForElement(".ytp-quality-menu .ytp-menuitem"),$$(".ytp-quality-menu .ytp-menuitem").forEach(e=>{e.addEventListener("click",()=>{let t=e.querySelector("div > div > span").textContent;const n={"4320p (8K)":"highres","2880p (5K)":"hd2880","2160p (4K)":"hd2160","1440p":"hd1440","1080p":"hd1080","720p":"hd720","480p":"large","360p":"medium","240p":"small","144p":"tiny"}[t.match(/\d+p/)?.[0]||t];localStorage.setItem("resolution",n),console.log(`Quality set to ${n}`)})})}const setHighestResolution=async()=>{const e=$("#movie_player");if(!e)return requestAnimationFrame(setHighestResolution);await new Promise(e=>setTimeout(e,200));const t=localStorage.getItem("resolution"),n=e.getAvailableQualityLevels(),o=n.includes(t)?t:n[0];e.setPlaybackQualityRange(o),e.setPlaybackQuality(o),console.log(`Quality set to ${o}`)};function getFormattedViewCount(e,t,n){let o=(e=parseInt(e,10)).toLocaleString("en-US");const i=[{threshold:1e12,suffix:" B"},{threshold:1e9,suffix:" M"},{threshold:1e6,suffix:" jt"},{threshold:1e3,suffix:" rb"}].find(({threshold:t})=>e>=t);if(i){o+=` (${a=e/i.threshold,(Math.floor(10*a)/10).toString().replace(".",",").replace(/,0$/,"")}${i.suffix})`}var a;return o+=n?" menunggu":t?" sedang menonton":" x ditonton",o}function getFormattedCountdown(e){const t=e-Math.floor(Date.now()/1e3);if(t<=0)return"Streaming akan dimulai sebentar lagi";const n=Math.floor(t/3600),o=Math.floor(t%3600/60);let i="Live dalam ";return n>0&&(i+=`${n} jam `),(o>0||n>0)&&(i+=`${o} menit `),i+=`${t%60} detik`,i}function startCountdown(e){return countdownInterval&&(clearInterval(countdownInterval),countdownInterval=null),countdownInterval=setInterval(()=>{const t=getFormattedCountdown(parseInt(e));updateViewDisplay(lastLoggedViewCount,!1,!0,t)},1e3),()=>{countdownInterval&&(clearInterval(countdownInterval),countdownInterval=null)}}function handleUpdatedMetadataRequest(e,t){if(e.includes("https://www.youtube.com/youtubei/v1/updated_metadata"))try{const e="string"==typeof t?JSON.parse(t):t;if(!e.actions||!Array.isArray(e.actions))return null;let n={viewership:null,dateText:null,isLive:!1};if(e.actions.forEach(e=>{if(e.updateViewershipAction){const t=e.updateViewershipAction.viewCount?.videoViewCountRenderer;if(n.isLive=!!t?.isLive,t){const o=t?.viewCount?.simpleText||null,i=o?o.split(" ")[0].replace(/[,.]/g,""):null;n.viewership={raw:e.updateViewershipAction,displayText:i?getFormattedViewCount(i,n.isLive,!1):null,rawCount:i}}}if(e.updateDateTextAction){const t=e.updateDateTextAction.dateText?.simpleText;t&&(n.dateText=getRelativeDateText(t),lastDateText=getRelativeDateText(t))}}),n.viewership){const e={items:[{snippet:{liveBroadcastContent:n.isLive?"live":"none",channelTitle:latestFetchedData?.initialData?.videoSecondaryInfoRenderer?.owner?.videoOwnerRenderer?.title?.runs?.[0]?.text||"",publishedAt:n.isLive?null:n.dateText||lastDateText},statistics:n.isLive?{}:{viewCount:n.viewership.rawCount},liveStreamingDetails:n.isLive?{concurrentViewers:n.viewership.rawCount,actualStartTime:n.dateText||lastDateText}:{}}],timestamp:(new Date).getTime()};latestFetchedData=e}return n.dateText||(n.dateText=lastDateText),n.viewership?n:null}catch(e){return console.error("❌ Failed to parse updated_metadata subclause:",e.message),null}return null}function interceptFetch(){const e=window.fetch;window.fetch=async function(t,n){const o="string"==typeof t?t:t.url,i=await e(t,n);try{if(o.includes("/youtubei/v1/updated_metadata")){const e=i.clone(),t=handleUpdatedMetadataRequest(o,await e.json());t&&t.viewership?.rawCount&&(lastLoggedViewCount!==t.viewership.rawCount&&(console.log("📊 Video Data Update:",{...t.viewership?.displayText&&{viewerCount:t.viewership.displayText},...t.dateText&&{startedAt:t.dateText},isLive:t.isLive}),lastLoggedViewCount=t.viewership.rawCount),updateViewDisplay(t.viewership.rawCount,t.isLive,!1,t.dateText))}}catch(e){console.error("❌ Error in fetch intercept:",e.message)}return i}}async function applyResumePlayback(e){if("/watch"===location.pathname&&!getIsLiveFromData(e)){const t=getCurrentVideoId();if(getIsLiveFromData(e))return console.log(`🎥 Video ${t} adalah live stream, skip resume playback`),void(shouldAddEventListenerTimeUpdate=!1);shouldAddEventListenerTimeUpdate=!0;const n=getSavedTime(t);if(n){const e=await waitForElement("video"),o=await waitForElement("#movie_player");e._resumeHandler&&e.removeEventListener("loadedmetadata",e._resumeHandler),e._resumeHandler=()=>{if(e.getAttribute("data-resumed")===t)return;let i=parseFloat(n);const a=e.duration;if(!isNaN(i))if(i=Math.max(0,i-2),i<a-5){o.seekTo(i,!0);const a=getFormattedTime(i);console.log(`🎬 Resuming playback at ${a} (original: ${getFormattedTime(parseFloat(n))})`),e.setAttribute("data-resumed",t)}else console.log("📺 Saved position too close to end, starting from beginning")},e.addEventListener("loadedmetadata",e._resumeHandler)}}}async function savePlaybackPosition(e){if(shouldAddEventListenerTimeUpdate)try{if("/watch"===location.pathname){const t=getCurrentVideoId();if(getIsLiveFromData(e))return void console.log(`🎥 Video ${t} adalah live stream, skip save playback position`);const n=await waitForElement("video");if(n&&!isNaN(n.currentTime)){const e=n.currentTime,o=n.duration;if(e>5&&e<o-5){localStorage.setItem(`yt_time_${t}`,e.toString());const n=getFormattedTime(e);console.log(`💾 Saved playback position (${n}) for video ${t}`)}}}}catch(e){console.error("Error saving video time:",e)}}function formatTime(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%60),i=e=>e.toString().padStart(2,"0");return`${i(t)}:${i(n)}:${i(o)}`}function getFormattedTime(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%60),i=e=>e.toString().padStart(2,"0");return`${i(t)}:${i(n)}:${i(o)}`}async function initYouTubeScript(){await main(),"/watch"===location.pathname&&await watch(),waitForUrlChange().then(()=>{console.log("URL berubah, menjalankan ulang skrip..."),cleanupVideoElements(),initYouTubeScript()})}function handlePageUnload(){audioNode=null,lastLoggedViewCount=null,console.log("Global variables reset"),async function(){try{if(!shouldAddEventListenerTimeUpdate)return;if("/watch"===location.pathname){const e=getCurrentVideoId(),t=await waitForElement("video");if(t&&!isNaN(t.currentTime)){const n=t.currentTime,o=t.duration;if(n>5&&n<o-5){localStorage.setItem(`yt_time_${e}`,n.toString());const t=getFormattedTime(n);console.log(`Saved playback position (${t}) for video ${e}`)}}}}catch(e){console.error("Error saving video time:",e)}}(),countdownInterval&&(clearInterval(countdownInterval),countdownInterval=null)}function cleanupVideoElements(){sponsorSegments=[],currentSponsorSegment=null,skipButton&&(skipButton.remove(),skipButton=null);document.querySelectorAll(".sponsor-segment-highlight").forEach(e=>e.remove());const e=document.querySelector(".ytp-time-watchable-container");e&&e.remove(),window.activeObservers&&Array.isArray(window.activeObservers)&&(window.activeObservers.forEach(e=>{e&&"function"==typeof e.disconnect&&e.disconnect()}),window.activeObservers=[])}function formatTimeToHHMMSS(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%60);return[t.toString().padStart(2,"0"),n.toString().padStart(2,"0"),o.toString().padStart(2,"0")].join(":")}function parseTimeToSeconds(e){const[t,n,o]=e.split(":").map(Number);return 3600*t+60*n+o}function generateUserID(){const e="0123456789abcdef";let t="";for(let n=0;n<30;n++)t+=e[Math.floor(16*Math.random())];return t}function getOrCreateUserID(){const e="sponsorblock_userid";let t=localStorage.getItem(e);return t||(t=generateUserID(),localStorage.setItem(e,t)),t}async function submitSponsorSegment(e,t){try{getVideoElement();const n=getVideoDuration(),o={videoID:e,userID:getOrCreateUserID(),userAgent:"YouTube-Fixed-Extension/1.0.0",service:"YouTube",videoDuration:n,segments:[{segment:[t.startTime,t.endTime],category:t.category,actionType:"skip",description:t.description||""}]},i=await fetch("https://sponsor.ajay.app/api/skipSegments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.message||`HTTP error! status: ${i.status}`)}return await i.json()}catch(e){throw console.error("❌ Error submitting segment:",e),e}}function showSubmitSegmentForm(e,t){const n=document.createElement("div");n.className="submit-segment-popup",n.innerHTML=`\n    <div class="submit-segment-popup-content">\n      <h3>Submit Sponsor Segment</h3>\n      <div class="submit-segment-form">\n        <div class="form-group">\n          <label>Category:</label>\n          <select id="segment-category">\n            <option value="sponsor">Sponsor</option>\n            <option value="selfpromo">Self Promotion</option>\n            <option value="interaction">Interaction Reminder</option>\n            <option value="intro">Intro</option>\n            <option value="outro">Outro</option>\n            <option value="preview">Preview</option>\n            <option value="music_offtopic">Music/Offtopic</option>\n            <option value="filler">Filler</option>\n          </select>\n        </div>\n        <div class="form-group">\n          <label>Description (optional):</label>\n          <input type="text" id="segment-description" placeholder="Describe the segment...">\n        </div>\n        <div class="form-group">\n          <label>Time Range:</label>\n          <div class="time-range-inputs">\n            <div class="time-input-group">\n              <label>Start Time:</label>\n              <input type="text" id="segment-start-time" \n                value="${getTimeStringFromSeconds(t)}" \n                placeholder="HH:MM:SS"\n                pattern="^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$">\n            </div>\n            <div class="time-input-group">\n              <label>End Time:</label>\n              <input type="text" id="segment-end-time" \n                value="${getTimeStringFromSeconds(t)}" \n                placeholder="HH:MM:SS"\n                pattern="^([0-1]?[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$">\n            </div>\n          </div>\n        </div>\n        <div class="submit-segment-buttons">\n        <button id="cancel-submit-segment" class="cancel-btn">Cancel</button>\n        <button id="submit-segment-btn" class="submit-btn">Submit</button>\n        </div>\n      </div>\n    </div>\n  `,document.body.appendChild(n);const o=()=>{n.remove(),document.removeEventListener("keydown",a),n.removeEventListener("click",i)},i=e=>{e.target===n&&o()},a=e=>{"Escape"===e.key&&o()};n.addEventListener("click",i),document.addEventListener("keydown",a);const r=e=>getIsValidTimeFormat(e.value)?(e.setCustomValidity(""),!0):(e.setCustomValidity("Format waktu harus HH:MM:SS"),!1),s=document.getElementById("segment-start-time"),l=document.getElementById("segment-end-time");s.addEventListener("input",()=>r(s)),l.addEventListener("input",()=>r(l)),document.getElementById("submit-segment-btn").addEventListener("click",async()=>{const t=document.getElementById("segment-category").value,o=document.getElementById("segment-description").value;if(!r(s)||!r(l))return void showNotification("Format waktu tidak valid","error");const i=getSecondsFromTime(s.value),a=getSecondsFromTime(l.value);if(i>=a)showNotification("Waktu mulai harus lebih kecil dari waktu selesai","error");else if(getIsValidSegmentData({startTime:i,endTime:a,category:t,description:o}))try{await submitSponsorSegment(e,{startTime:i,endTime:a,category:t,description:o}),showNotification("Segment berhasil disubmit!","success"),n.remove()}catch(e){showNotification("Gagal submit segment: "+e.message,"error")}else showNotification("Data segment tidak valid","error")}),document.getElementById("cancel-submit-segment").addEventListener("click",()=>{o()})}function showNotification(e,t="info"){getIsValidNotificationType(t)||(t="info");const n=document.createElement("div");n.className=`segment-notification ${t}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.classList.add("show")},100),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>n.remove(),300)},3e3)}function getRelativeDateText(e){const t=e.match(/^(\d{1,2}) (\w{3,}) (\d{4})$/);if(!t)return e;const[n,o,i,a]=t,r={Jan:0,Feb:1,Mar:2,Apr:3,Mei:4,Jun:5,Jul:6,Agu:7,Sep:8,Okt:9,Nov:10,Des:11}[i];if(void 0===r)return e;const s=new Date(a,r,o);s.setHours(0,0,0,0);const l=new Date;l.setHours(0,0,0,0);const c=l-s,u=Math.floor(c/864e5);return u<0?"Tanggal di masa depan":0===u?"Hari ini":1===u?"1 hari yang lalu":`${u} hari yang lalu`}function getPlayerResponseData(e){try{const t=(new DOMParser).parseFromString(e,"text/html"),n=Array.from(t.querySelectorAll("script")).find(e=>e.textContent.includes("ytInitialPlayerResponse"));if(!n)return console.warn("getPlayerResponseData - Tidak dapat menemukan script yang mengandung ytInitialPlayerResponse"),null;const o=n.textContent.match(/ytInitialPlayerResponse\s*=\s*({[\s\S]*?});/);if(!o||!o[1])return console.warn("getPlayerResponseData - Tidak dapat menemukan JSON dalam script"),null;return filterData(JSON.parse(o[1]),filterConfig.ytInitialPlayerResponse)}catch(e){return console.error("getPlayerResponseData - Error parsing playerResponse:",e),null}}function getYtInitialData(e){try{const t=(new DOMParser).parseFromString(e,"text/html"),n=Array.from(t.querySelectorAll("script")).find(e=>e.textContent.includes("ytInitialData"));if(!n)return console.warn("getYtInitialData - Tidak dapat menemukan script yang mengandung ytInitialData"),null;const o=n.textContent.match(/ytInitialData\s*=\s*({[\s\S]*?});/);if(!o||!o[1])return console.warn("getYtInitialData - Tidak dapat menemukan JSON dalam script"),null;return filterData(JSON.parse(o[1]),filterConfig.ytInitialData)}catch(e){return console.error("getYtInitialData - Error parsing ytInitialData:",e),null}}function getUpcomingDateText(e){try{if(!e)return null;let t=null,n=null;if("LIVE_STREAM_OFFLINE"===e.playabilityStatus?.status&&e.playabilityStatus?.liveStreamability?.liveStreamabilityRenderer?.offlineSlate?.liveStreamOfflineSlateRenderer){const o=e.playabilityStatus.liveStreamability.liveStreamabilityRenderer.offlineSlate.liveStreamOfflineSlateRenderer;if(n=o.scheduledStartTime,n)t=getFormattedCountdown(parseInt(n));else{const e=o.mainText?.runs||[];e.length>0&&(t=e.map(e=>e.text).join(""))}}return{upcomingDateText:t,scheduledStartTime:n}}catch(e){return console.error("getUpcomingDateText - Error:",e),{upcomingDateText:null,scheduledStartTime:null}}}function getDataWithMultiplePatterns(e,t,n){try{for(let o=0;o<t.length;o++){const i=t[o],a=e.match(i);if(a&&a[1]){console.log(`getDataWithMultiplePatterns - ${n} found with pattern ${o+1}`);try{return JSON.parse(a[1])}catch(e){console.warn(`getDataWithMultiplePatterns - Failed to parse ${n} with pattern ${o+1}:`,e);continue}}}return console.warn(`getDataWithMultiplePatterns - ${n} tidak ditemukan dengan semua pattern`),null}catch(e){return console.error(`getDataWithMultiplePatterns - Error parsing ${n}:`,e),null}}function parseTitleWithMentions(e){if(!e||!Array.isArray(e))return"";const t=document.createElement("span");return e.forEach(e=>{if(e.navigationEndpoint?.browseEndpoint){const n=document.createElement("a");n.href=e.navigationEndpoint.commandMetadata.webCommandMetadata.url,n.className="mention",n.target="_blank",n.textContent=e.text,t.appendChild(n)}else{const n=document.createTextNode(e.text);t.appendChild(n)}}),t}async function displayTitleWithMentions(e){try{const t=e?.contents?.twoColumnWatchNextResults?.results?.results?.contents?.[0]?.videoPrimaryInfoRenderer?.title?.runs;if(t){const e=await waitForElement("ytd-watch-metadata[title-headline-xs] h1.ytd-watch-metadata");e&&(e.textContent="",e.appendChild(parseTitleWithMentions(t)))}}catch(e){console.error("Error displaying title with mentions:",e)}}window.addEventListener("beforeunload",handlePageUnload),initYouTubeScript();