console.log("allow pasting"),console.log("_legacyUndefinedCheck: true");let audioNode=null,currentVideoId=null,loopState=localStorage.getItem("loopState")||"0",isBassBoosted=JSON.parse(localStorage.getItem("bassBoost")||"false"),isMuted=JSON.parse(localStorage.getItem("muted")||"0"),isAudioNodeCreated=!1;function getCurrentVideoId(){return new URL(location.href).searchParams.get("id")}window.trustedTypes&&window.trustedTypes.createPolicy&&window.trustedTypes.createPolicy("default",{createHTML:e=>e,createScriptURL:e=>e,createScript:e=>e});const $=document.querySelector.bind(document),$$=document.querySelectorAll.bind(document),wait=e=>new Promise(t=>setTimeout(t,e));function waitForElement(e){return new Promise(t=>{const o=()=>{const n=$(e);n?t(n):requestAnimationFrame(o)};o()})}const main=async()=>{console.log("Main function started"),console.log("Current Video ID:",getCurrentVideoId());injectSettingsButton(await waitForElement("body")),injectPopup(),await handleVideoElement(getCurrentVideoId()),await applyShortcutKeys()},handleVideoElement=async e=>{console.log("Handling video element for: ",e),await waitForElement("video").then(e=>{console.log("Video element found: ",e),e.readyState>=2?(console.log("Video is ready to play"),applyVideoState(),applyBassBoostState(),e.play()):(console.log("Waiting for video to be ready..."),e.addEventListener("canplay",()=>{console.log("Video is now ready to play"),applyVideoState(),applyBassBoostState()}))})};function injectSettingsButton(e){if($(".injector-settings"))return;const t=document.createElement("button");t.className="injector-settings",t.title="Settings",t.innerHTML='\n    <svg width="24" height="24" viewBox="0 0 24 24">\n      <path fill="currentColor" \n        d="m9.25 22l-.4-3.2q-.325-.125-.612-.3t-.563-.375L4.7 19.375l-2.75-4.75l2.575-1.95Q4.5 12.5 4.5 12.338v-.675q0-.163.025-.338L1.95 9.375l2.75-4.75l2.975 1.25q.275-.2.575-.375t.6-.3l.4-3.2h5.5l.4 3.2q.325.125.613.3t.562.375l2.975-1.25l2.75 4.75l-2.575 1.95q.025.175.025.338v.674q0 .163-.05.338l2.575 1.95l-2.75 4.75l-2.95-1.25q-.275.2-.575.375t-.6.3l-.4 3.2zM11 20h1.975l.35-2.65q.775-.2 1.438-.587t1.212-.938l2.475 1.025l.975-1.7l-2.15-1.625q.125-.35.175-.737T17.5 12t-.05-.787t-.175-.738l2.15-1.625l-.975-1.7l-2.475 1.05q-.55-.575-1.212-.962t-1.438-.588L13 4h-1.975l-.35 2.65q-.775.2-1.437.588t-1.213.937L5.55 7.15l-.975 1.7l2.15 1.6q-.125.375-.175.75t-.05.8q0 .4.05.775t.175.75l-2.15 1.625l.975 1.7l2.475-1.05q.55.575 1.213.963t1.437.587zm1.05-4.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5M12 12"/>\n    </svg>',t.onclick=()=>$("#settings-popup").style.display="flex",e.append(t)}function injectPopup(){if($("#settings-popup"))return;document.body.insertAdjacentHTML("beforeend",`\n    <div class="settings-popup" id="settings-popup">\n      <div class="settings-popup-content">\n        <h3>Settings</h3>\n        <div class="settings-list">\n          \x3c!-- Looping (2-state) --\x3e\n          <div class="setting-item">\n            <label>Looping</label>\n            <select id="loop-select">\n              <option value="0" ${"0"===loopState?"selected":""}>Off</option>\n              <option value="1" ${"1"===loopState?"selected":""}>On</option>\n            </select>\n          </div>\n\n          \x3c!-- Bass Boost (boolean) --\x3e\n          <div class="setting-item">\n            <label>Bass Boost</label>\n            <select data-key="bassBoost">\n              <option value="false" ${isBassBoosted?"":"selected"}>Off</option>\n              <option value="true"  ${isBassBoosted?"selected":""}>On</option>\n            </select>\n          </div>\n\n          \x3c!-- Default Muted (boolean) --\x3e\n          <div class="setting-item">\n            <label>Always Muted</label>\n            <select data-key="muted">\n              <option value="0" ${"0"===!isMuted?"selected":""}>Off</option>\n              <option value="1"  ${"1"===isMuted?"selected":""}>On</option>\n            </select>\n          </div>\n        </div>\n\n        <div class="settings-buttons">\n          <button id="close-settings">Close</button>\n          <button id="save-settings">Save</button>\n        </div>\n      </div>\n    </div>\n  `);const e=$("#settings-popup");e.onclick=t=>{t.target===e&&(e.style.display="none")},document.onkeydown=t=>{"Escape"===t.key&&"flex"===e.style.display&&(e.style.display="none")},$("#close-settings").onclick=()=>e.style.display="none",$("#save-settings").onclick=()=>{const t=$("#loop-select").value;localStorage.setItem("loopState",t),loopState=t,applyVideoState();const o="true"===$$('#settings-popup select[data-key="bassBoost"]')[0].value;localStorage.setItem("bassBoost",o),isBassBoosted=o,applyBassBoostState();const n=$$('#settings-popup select[data-key="muted"]')[0].value;localStorage.setItem("muted",n),isMuted=n,applyVideoState(),e.style.display="none",console.log("Settings saved:",{loopState:loopState,isBassBoosted:isBassBoosted,isMuted:isMuted})}}const applyVideoState=()=>{const e=$("video");e&&(e.loop="1"===loopState,e.muted="1"===isMuted)};function applyBassBoostState(){const e=$("video");e&&(isBassBoosted&&!isAudioNodeCreated?(isAudioNodeCreated=createAudioNode(e),e.setAttribute("data-bass-boosted","true")):!isBassBoosted&&isAudioNodeCreated&&(destroyAudioNode(),e.removeAttribute("data-bass-boosted")))}function destroyAudioNode(){window.ytmAudioCtx&&(window.ytmAudioCtx.close(),window.ytmAudioCtx=null,isAudioNodeCreated=!1,console.log("Bass-Boost audio node destroyed"))}function createAudioNode(e){if(window.ytmAudioCtx)return!0;const t=new(window.AudioContext||window.webkitAudioContext);window.ytmAudioCtx=t;const o=t.createMediaElementSource(e),n=t.createGain(),s=t.createBiquadFilter(),a=t.createGain(),i={31:{frequency:31,gain:15},62:{frequency:62,gain:10},125:{frequency:125,gain:5},250:{frequency:250,gain:0},500:{frequency:500,gain:-5},1e3:{frequency:1e3,gain:-5},2e3:{frequency:2e3,gain:0},4e3:{frequency:4e3,gain:5},8e3:{frequency:8e3,gain:10},16e3:{frequency:16e3,gain:15}};for(const e in i){const t=i[e];s.frequency.value=t.frequency,s.Q.value=4,s.gain.value=t.gain}return n.gain.value=.2,a.gain.value=5.7,o.connect(n),n.connect(s),s.connect(a),a.connect(t.destination),console.log("Bass Boosted!"),!0}const applyShortcutKeys=async()=>{document.addEventListener("keydown",e=>{applyKeys(e)}),await waitForElement("video").then(e=>{e.addEventListener("keydown",e=>{applyKeys(e)})})},applyKeys=e=>{if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||e.target.isContentEditable)return;const t=$("video");if(t)switch(e.key.toLowerCase()){case" ":e.preventDefault(),t.paused?t.play():t.pause();break;case"m":e.preventDefault(),t.muted=!t.muted,localStorage.setItem("muted",t.muted?"1":"0"),isMuted=t.muted?"1":"0",applyVideoState();break;case"arrowright":e.preventDefault(),t.currentTime=Math.min(t.duration,t.currentTime+5);break;case"arrowleft":e.preventDefault(),t.currentTime=Math.max(0,t.currentTime-5);break;case"arrowup":e.preventDefault(),t.volume=Math.min(1,t.volume+.1);break;case"arrowdown":e.preventDefault(),t.volume=Math.max(0,t.volume-.1);break;case"l":e.preventDefault(),isLoop=t.loop?"0":"1",localStorage.setItem("loopState",isLoop),loopState=isLoop,applyVideoState();break;case"b":e.preventDefault(),isBassBoosted=!isBassBoosted,localStorage.setItem("bassBoost",isBassBoosted),applyBassBoostState()}};main();