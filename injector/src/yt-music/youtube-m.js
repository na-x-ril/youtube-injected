console.log("allow pasting");const $=document.querySelector.bind(document),$$=document.querySelectorAll.bind(document),wait=t=>new Promise(e=>setTimeout(e,t));window.trustedTypes&&window.trustedTypes.createPolicy&&window.trustedTypes.createPolicy("default",{createHTML:t=>t,createScriptURL:t=>t,createScript:t=>t});let loopState=localStorage.getItem("loopState")||"0",isBassBoosted=JSON.parse(localStorage.getItem("bassBoost")||"false"),isAudioNodeCreated=!1,previousVideoURL=null;async function initYoutubeMusicScript(){await main(),"/watch"===location.pathname&&await watch(),waitForUrlChange().then(()=>{console.log("URL changed"),initYoutubeMusicScript()})}async function main(){const t=await waitForElement("#right-content");injectSettingsButton(t),injectPopup()}async function watch(){await waitForElement("video").then(t=>{t.readyState>=2?(console.log("Video is ready to play"),applyBassBoostState()):(console.log("Waiting for video to be ready..."),t.addEventListener("canplay",()=>{console.log("Video is now ready to play"),applyBassBoostState()})),"0"!==loopState&&applyLoopState()})}function waitForUrlChange(){return new Promise(t=>{let e=location.href;const o=()=>{location.href!==e?(e=location.href,t(e)):requestAnimationFrame(o)};o()})}function waitForElement(t){return new Promise(e=>{const o=()=>{const n=$(t);n?e(n):requestAnimationFrame(o)};o()})}function injectSettingsButton(t){if($(".injector-settings"))return;const e=document.createElement("button");e.className="injector-settings",e.title="Settings",e.innerHTML='\n    <svg width="24" height="24" viewBox="0 0 24 24">\n      <path fill="currentColor" \n        d="m9.25 22l-.4-3.2q-.325-.125-.612-.3t-.563-.375L4.7 19.375l-2.75-4.75l2.575-1.95Q4.5 12.5 4.5 12.338v-.675q0-.163.025-.338L1.95 9.375l2.75-4.75l2.975 1.25q.275-.2.575-.375t.6-.3l.4-3.2h5.5l.4 3.2q.325.125.613.3t.562.375l2.975-1.25l2.75 4.75l-2.575 1.95q.025.175.025.338v.674q0 .163-.05.338l2.575 1.95l-2.75 4.75l-2.95-1.25q-.275.2-.575.375t-.6.3l-.4 3.2zM11 20h1.975l.35-2.65q.775-.2 1.438-.587t1.212-.938l2.475 1.025l.975-1.7l-2.15-1.625q.125-.35.175-.737T17.5 12t-.05-.787t-.175-.738l2.15-1.625l-.975-1.7l-2.475 1.05q-.55-.575-1.212-.962t-1.438-.588L13 4h-1.975l-.35 2.65q-.775.2-1.437.588t-1.213.937L5.55 7.15l-.975 1.7l2.15 1.6q-.125.375-.175.75t-.05.8q0 .4.05.775t.175.75l-2.15 1.625l.975 1.7l2.475-1.05q.55.575 1.213.963t1.437.587zm1.05-4.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5M12 12"/>\n    </svg>',e.onclick=()=>$("#ytm-settings-popup").style.display="flex",t.append(e)}function injectSettingsButton(t){if($(".injector-settings"))return;const e=document.createElement("button");e.className="injector-settings",e.title="Settings",e.innerHTML='\n    <svg width="24" height="24" viewBox="0 0 24 24">\n      <path fill="currentColor"\n            d="m9.25 22l-.4-3.2q-.325-.125-.612-.3t-.563-.375L4.7 19.375l-2.75-4.75l2.575-1.95Q4.5 12.5 4.5 12.338v-.675q0-.163.025-.338L1.95 9.375l2.75-4.75l2.975 1.25q.275-.2.575-.375t.6-.3l.4-3.2h5.5l.4 3.2q.325.125.613.3t.562.375l2.975-1.25l2.75 4.75l-2.575 1.95q.025.175.025.338v.674q0 .163-.05.338l2.575 1.95l-2.75 4.75l-2.95-1.25q-.275.2-.575.375t-.6.3l-.4 3.2zM11 20h1.975l.35-2.65q.775-.2 1.438-.587t1.212-.938l2.475 1.025l.975-1.7l-2.15-1.625q.125-.35.175-.737T17.5 12t-.05-.787t-.175-.738l2.15-1.625l-.975-1.7l-2.475 1.05q-.55-.575-1.212-.962t-1.438-.588L13 4h-1.975l-.35 2.65q-.775.2-1.437.588t-1.213.937L5.55 7.15l-.975 1.7l2.15 1.6q-.125.375-.175.75t-.05.8q0 .4.05.775t.175.75l-2.15 1.625l.975 1.7l2.475-1.05q.55.575 1.213.963t1.437.587zm1.05-4.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5M12 12"/>\n    </svg>',e.onclick=()=>$("#ytm-settings-popup").style.display="flex",t.append(e)}function injectPopup(){if($("#ytm-settings-popup"))return;document.body.insertAdjacentHTML("beforeend",`\n    <div class="skip-settings-popup" id="ytm-settings-popup">\n      <div class="skip-settings-popup-content">\n        <h3>YouTube-Music Settings</h3>\n        <div class="skip-settings-list">\n          \x3c!-- Looping (3-state) --\x3e\n          <div class="skip-setting-item">\n            <label>Looping</label>\n            <select id="ytm-loop-select">\n              <option value="0" ${"0"===loopState?"selected":""}>Off</option>\n              <option value="1" ${"1"===loopState?"selected":""}>All</option>\n              <option value="2" ${"2"===loopState?"selected":""}>One</option>\n            </select>\n          </div>\n\n          \x3c!-- Bass Boost (boolean) --\x3e\n          <div class="skip-setting-item">\n            <label>Bass Boost</label>\n            <select data-key="bassBoost">\n              <option value="false" ${isBassBoosted?"":"selected"}>Off</option>\n              <option value="true"  ${isBassBoosted?"selected":""}>On</option>\n            </select>\n          </div>\n        </div>\n\n        <div class="skip-settings-buttons">\n          <button id="ytm-close-settings">Close</button>\n          <button id="ytm-save-settings">Save</button>\n        </div>\n      </div>\n    </div>\n  `);const t=$("#ytm-settings-popup");t.onclick=e=>{e.target===t&&(t.style.display="none")},document.onkeydown=e=>{"Escape"===e.key&&"flex"===t.style.display&&(t.style.display="none")},$("#ytm-close-settings").onclick=()=>t.style.display="none",$("#ytm-save-settings").onclick=()=>{const e=$("#ytm-loop-select").value;localStorage.setItem("loopState",e),loopState=e,applyLoopState();const o="true"===$$('#ytm-settings-popup select[data-key="bassBoost"]')[0].value;localStorage.setItem("bassBoost",o),isBassBoosted=o,applyBassBoostState(),t.style.display="none",console.log("Settings saved:",{loopState:loopState,isBassBoosted:isBassBoosted})}}function applyLoopState(){waitForElement(".right-controls-buttons .repeat button").then(t=>{const e=getRealLoopState();if(loopState===e)return;const o=(parseInt(loopState)-parseInt(e)+3)%3;for(let e=0;e<o;e++)t.click();console.log(`Looping â†’ ${["OFF","ALL","ONE"][loopState]}`)})}function applyBassBoostState(){const t=$("video");t&&(isBassBoosted&&!isAudioNodeCreated?isAudioNodeCreated=createAudioNode(t):!isBassBoosted&&isAudioNodeCreated&&destroyAudioNode())}function destroyAudioNode(){window.ytmAudioCtx&&(window.ytmAudioCtx.close(),window.ytmAudioCtx=null,isAudioNodeCreated=!1,console.log("Bass-Boost audio node destroyed"))}function getRealLoopState(){const t=$(".right-controls-buttons .repeat button");if(!t)return loopState;const e=t.getAttribute("aria-label")||"";return e.includes("nonaktif")||e.includes("No repeat")?"0":e.includes("semua")||e.includes("Repeat all")?"1":e.includes("satu")||e.includes("Repeat one")?"2":loopState}function createAudioNode(t){if(window.ytmAudioCtx)return!0;const e=new(window.AudioContext||window.webkitAudioContext);window.ytmAudioCtx=e;const o=e.createMediaElementSource(t),n=e.createGain(),s=e.createBiquadFilter(),i=e.createGain(),l={31:{frequency:31,gain:15},62:{frequency:62,gain:10},125:{frequency:125,gain:5},250:{frequency:250,gain:0},500:{frequency:500,gain:-5},1e3:{frequency:1e3,gain:-5},2e3:{frequency:2e3,gain:0},4e3:{frequency:4e3,gain:5},8e3:{frequency:8e3,gain:10},16e3:{frequency:16e3,gain:15}};for(const t in l){const e=l[t];s.frequency.value=e.frequency,s.Q.value=4,s.gain.value=e.gain}return n.gain.value=.2,i.gain.value=4.7,o.connect(n),n.connect(s),s.connect(i),i.connect(e.destination),console.log("Bass Boosted!"),!0}initYoutubeMusicScript();